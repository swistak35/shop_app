library("DBI")
library("RPostgreSQL")
library("ggplot2")
drv <- dbDriver("PostgreSQL")
con <- dbConnect(drv, dbname="shop_app_development", user="shop_app_user", password="")
rs <- dbSendQuery(con, "SELECT COUNT(order_id), to_char(date, 'YYYY-MM') AS month, items_count FROM (SELECT orders.id AS order_id, COUNT(order_items.id) AS items_count, date_trunc('month', orders.created_at) AS date FROM orders INNER JOIN order_items ON orders.id = order_items.order_id GROUP BY orders.id, orders.created_at) AS subtable GROUP BY date, items_count ORDER BY items_count;")
chunk <- fetch(rs, n=-1)
chunk$date = sapply(chunk$month, format, "%Y-%m")
ggplot(chunk, aes(x=month, y=count, group=items_count, colour=items_count)) + geom_point() + geom_line()
